<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vector Addition Visualizer</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #f8fafc;
            color: #334155;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .container {
            background: white;
            padding: 24px;
            border-radius: 16px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            width: 100%;
            max-width: 800px;
        }

        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 24px;
            background: #f1f5f9;
            padding: 16px;
            border-radius: 12px;
        }

        .vector-control {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .vector-header {
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .color-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .input-group {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        label {
            font-size: 0.9em;
            color: #64748b;
            min-width: 20px;
        }

        input[type="number"] {
            width: 60px;
            padding: 6px;
            border: 1px solid #cbd5e1;
            border-radius: 6px;
            font-family: inherit;
        }

        canvas {
            width: 100%;
            height: 400px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            background: #ffffff;
            cursor: move;
            touch-action: none;
        }

        .readout {
            margin-top: 16px;
            font-family: "JetBrains Mono", monospace;
            background: #1e293b;
            color: #e2e8f0;
            padding: 12px;
            border-radius: 8px;
            display: flex;
            justify-content: center;
            gap: 24px;
        }

        .instructions {
            margin-top: 12px;
            text-align: center;
            color: #64748b;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="controls">
            <div class="vector-control">
                <div class="vector-header">
                    <div class="color-dot" style="background: #3b82f6;"></div>
                    <span>Vector u (Blue)</span>
                </div>
                <div class="input-group">
                    <label>x:</label>
                    <input type="number" id="ux" value="3" onchange="updateFromInputs()">
                    <label>y:</label>
                    <input type="number" id="uy" value="1" onchange="updateFromInputs()">
                </div>
            </div>
            <div class="vector-control">
                <div class="vector-header">
                    <div class="color-dot" style="background: #ef4444;"></div>
                    <span>Vector v (Red)</span>
                </div>
                <div class="input-group">
                    <label>x:</label>
                    <input type="number" id="vx" value="1" onchange="updateFromInputs()">
                    <label>y:</label>
                    <input type="number" id="vy" value="3" onchange="updateFromInputs()">
                </div>
            </div>
        </div>

        <canvas id="canvas"></canvas>

        <div class="readout">
            <span id="sum-readout">u + v = [4, 4]</span>
            <span id="mag-readout">|u+v| = 5.66</span>
        </div>
        
        <div class="instructions">
            Drag the arrow heads to interact with the vectors directly.
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        
        let width, height, centerX, centerY;
        const scale = 40; // Pixels per unit

        let u = { x: 3, y: 1 };
        let v = { x: 1, y: 3 };

        let isDragging = null; // 'u', 'v', or null

        function resize() {
            // Get actual display size
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width * window.devicePixelRatio;
            canvas.height = rect.height * window.devicePixelRatio;
            
            width = canvas.width;
            height = canvas.height;
            centerX = width / 2;
            centerY = height / 2;
            
            // Normalize scale for high DPI
            ctx.scale(window.devicePixelRatio, window.devicePixelRatio);
            // Adjust calculation dimensions to match CSS pixels
            width = rect.width;
            height = rect.height;
            centerX = width / 2;
            centerY = height / 2;
            
            draw();
        }

        window.addEventListener('resize', resize);

        function drawGrid() {
            ctx.strokeStyle = '#e2e8f0';
            ctx.lineWidth = 1;

            // Vertical lines
            for (let x = centerX % scale; x < width; x += scale) {
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, height);
                ctx.stroke();
            }

            // Horizontal lines
            for (let y = centerY % scale; y < height; y += scale) {
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(width, y);
                ctx.stroke();
            }

            // Axes
            ctx.strokeStyle = '#94a3b8';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(0, centerY);
            ctx.lineTo(width, centerY);
            ctx.stroke();

            ctx.beginPath();
            ctx.moveTo(centerX, 0);
            ctx.lineTo(centerX, height);
            ctx.stroke();
        }

        function drawArrow(fromX, fromY, toX, toY, color, label, isSum = false) {
            const headLength = 15;
            const angle = Math.atan2(toY - fromY, toX - fromX);

            ctx.strokeStyle = color;
            ctx.fillStyle = color;
            ctx.lineWidth = isSum ? 4 : 3;

            // Line
            if (isSum) ctx.setLineDash([5, 5]);
            else ctx.setLineDash([]);
            
            ctx.beginPath();
            ctx.moveTo(fromX, fromY);
            ctx.lineTo(toX, toY);
            ctx.stroke();
            ctx.setLineDash([]);

            // Head
            ctx.beginPath();
            ctx.moveTo(toX, toY);
            ctx.lineTo(toX - headLength * Math.cos(angle - Math.PI / 6), toY - headLength * Math.sin(angle - Math.PI / 6));
            ctx.lineTo(toX - headLength * Math.cos(angle + Math.PI / 6), toY - headLength * Math.sin(angle + Math.PI / 6));
            ctx.closePath();
            ctx.fill();
            
            // Label background
            if (label) {
                const midX = (fromX + toX) / 2;
                const midY = (fromY + toY) / 2;
                
                ctx.font = "bold 14px sans-serif";
                const metrics = ctx.measureText(label);
                const padding = 4;
                
                ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
                ctx.fillRect(midX - metrics.width/2 - padding, midY - 20 - padding, metrics.width + padding*2, 20 + padding*2);
                
                ctx.fillStyle = color;
                ctx.textAlign = 'center';
                ctx.fillText(label, midX, midY - 5);
            }
        }

        function draw() {
            ctx.clearRect(0, 0, width, height); // Clear using logical dimensions since we scaled context
            drawGrid();

            const originX = centerX;
            const originY = centerY;

            // Draw u
            const uTipX = originX + u.x * scale;
            const uTipY = originY - u.y * scale; // Y is inverted in canvas
            drawArrow(originX, originY, uTipX, uTipY, '#3b82f6', `u [${u.x}, ${u.y}]`);

            // Draw v (start from origin)
            const vTipX = originX + v.x * scale;
            const vTipY = originY - v.y * scale;
            drawArrow(originX, originY, vTipX, vTipY, '#ef4444', `v [${v.x}, ${v.y}]`);

            // Draw Sum (Result)
            const sumX = u.x + v.x;
            const sumY = u.y + v.y;
            const sumTipX = originX + sumX * scale;
            const sumTipY = originY - sumY * scale;
            drawArrow(originX, originY, sumTipX, sumTipY, '#10b981', 'u + v', true);

            // Draw "Ghost" vectors to show tip-to-tail
            // Ghost v starting at u
            ctx.globalAlpha = 0.3;
            drawArrow(uTipX, uTipY, sumTipX, sumTipY, '#ef4444', null);
            ctx.globalAlpha = 1.0;
        }

        function updateInputs() {
            document.getElementById('ux').value = u.x;
            document.getElementById('uy').value = u.y;
            document.getElementById('vx').value = v.x;
            document.getElementById('vy').value = v.y;

            const sumX = u.x + v.x;
            const sumY = u.y + v.y;
            const mag = Math.sqrt(sumX*sumX + sumY*sumY).toFixed(2);
            
            document.getElementById('sum-readout').textContent = `u + v = [${sumX}, ${sumY}]`;
            document.getElementById('mag-readout').textContent = `|u+v| = ${mag}`;
        }

        function updateFromInputs() {
            u.x = parseFloat(document.getElementById('ux').value) || 0;
            u.y = parseFloat(document.getElementById('uy').value) || 0;
            v.x = parseFloat(document.getElementById('vx').value) || 0;
            v.y = parseFloat(document.getElementById('vy').value) || 0;
            draw();
            updateInputs(); // To update sum readout
        }

        // Interaction
        function getMousePos(evt) {
            const rect = canvas.getBoundingClientRect();
            return {
                x: evt.clientX - rect.left,
                y: evt.clientY - rect.top
            };
        }

        function posToGrid(pos) {
            return {
                x: Math.round((pos.x - centerX) / scale),
                y: Math.round((centerY - pos.y) / scale)
            };
        }

        function checkHit(pos, vector) {
            const tipX = centerX + vector.x * scale;
            const tipY = centerY - vector.y * scale;
            const dist = Math.sqrt((pos.x - tipX) ** 2 + (pos.y - tipY) ** 2);
            return dist < 20;
        }

        canvas.addEventListener('mousedown', (e) => {
            const pos = getMousePos(e);
            if (checkHit(pos, u)) isDragging = 'u';
            else if (checkHit(pos, v)) isDragging = 'v';
        });

        canvas.addEventListener('mousemove', (e) => {
            if (!isDragging) {
                const pos = getMousePos(e);
                canvas.style.cursor = (checkHit(pos, u) || checkHit(pos, v)) ? 'pointer' : 'default';
                return;
            }

            const pos = getMousePos(e);
            
            // Snap to approximate grid for smoother feel, or exact float
            // Let's do exact float dragging but snap to integer on release? 
            // Better: Snap to 0.5 grid?
            
            const gridX = (pos.x - centerX) / scale;
            const gridY = (centerY - pos.y) / scale;

            if (isDragging === 'u') {
                u.x = Math.round(gridX * 2) / 2;
                u.y = Math.round(gridY * 2) / 2;
            } else {
                v.x = Math.round(gridX * 2) / 2;
                v.y = Math.round(gridY * 2) / 2;
            }
            
            draw();
            updateInputs();
        });

        window.addEventListener('mouseup', () => {
            isDragging = null;
        });

        // Initialize
        resize();
        updateInputs();

    </script>
</body>
</html>
