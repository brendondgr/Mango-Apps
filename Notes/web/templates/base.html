{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Notetaking System{% endblock %}</title>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,wght@0,400;0,500;0,700;1,400&family=JetBrains+Mono:wght@400;500&family=Space+Grotesk:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- CSS Variables & Design System -->
    <link rel="stylesheet" href="{% static 'notes/css/variables.css' %}">
    <link rel="stylesheet" href="{% static 'notes/css/modals.css' %}">
    <link rel="stylesheet" href="{% static 'notes/css/styles.css' %}">


    <style>
        /* Minimal Reset & Base Styles */
        *, *::before, *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: var(--font-body);
            background-color: var(--color-bg-base);
            color: #1f2937; /* Default dark text */
            line-height: 1.5;
            -webkit-font-smoothing: antialiased;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        h1, h2, h3, h4, h5, h6 {
            font-family: var(--font-heading);
            font-weight: 600;
        }

        /* Glassmorphism Classes Helper */
        .glass-panel {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            box-shadow: var(--shadow-sm);
        }
    </style>

    <!-- MathJax & KaTeX Configuration -->
    <!-- KaTeX -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV" crossorigin="anonymous">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js" integrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8" crossorigin="anonymous"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js" integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"
        onload="renderMathInElement(document.body, {
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '\\[', right: '\\]', display: true},
                {left: '$', right: '$', display: false},
                {left: '\\(', right: '\\)', display: false}
            ]
        });"></script>

    <!-- MathJax 3.x -->
    <script>
    window.MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']],
        displayMath: [['$$', '$$'], ['\\[', '\\]']],
        processEscapes: true
      }
    };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    {% block extra_head %}{% endblock %}
</head>
<body>
    <!-- Global Header -->
    <header class="site-header glass-panel">
        <div class="site-header__container">
            <!-- Logo/Name - clickable to home -->
            <a href="{% url 'notes:index' %}" class="site-header__logo">
                StudyHub
            </a>

            <!-- Right-aligned actions -->
            <nav class="site-header__actions">
                <!-- New Dropdown -->
                <div class="dropdown">
                    <button class="btn btn-ghost dropdown__trigger" type="button" aria-haspopup="true" aria-expanded="false">
                        <span class="icon-mask" style="-webkit-mask-image: url('{% static 'notes/svg/plus.svg' %}'); mask-image: url('{% static 'notes/svg/plus.svg' %}');"></span>
                        New
                        <svg class="dropdown__caret" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="6 9 12 15 18 9"></polyline>
                        </svg>
                    </button>
                    <div class="dropdown__menu">
                        <a href="{% url 'notes:subject_create' %}" class="dropdown__item">
                            <span class="icon-mask icon-mask--sm" style="-webkit-mask-image: url('{% static 'notes/svg/grid-2x2.svg' %}'); mask-image: url('{% static 'notes/svg/grid-2x2.svg' %}');"></span>
                            New Subject
                        </a>
                        <a href="{% url 'notes:course_create' %}" class="dropdown__item">
                            <span class="icon-mask icon-mask--sm" style="-webkit-mask-image: url('{% static 'notes/svg/import.svg' %}'); mask-image: url('{% static 'notes/svg/import.svg' %}');"></span>
                            New Course
                        </a>
                    </div>
                </div>

                <!-- Generate Topic -->
                <a href="{% url 'notes:generate_topic' %}" class="btn btn-primary">
                    <span class="icon-mask" style="-webkit-mask-image: url('{% static 'notes/svg/sparkles.svg' %}'); mask-image: url('{% static 'notes/svg/sparkles.svg' %}');"></span>
                    Generate Topic
                </a>

                <!-- Settings -->
                <a href="{% url 'notes:settings' %}" class="btn btn-ghost" title="Settings">
                    <span class="icon-mask" style="-webkit-mask-image: url('{% static 'notes/svg/settings.svg' %}'); mask-image: url('{% static 'notes/svg/settings.svg' %}');"></span>
                    Settings
                </a>
            </nav>
        </div>
    </header>

    <main style="flex: 1; position: relative;">
        {% block content %}
        {% endblock %}
    </main>

    <script src="{% static 'notes/js/modals.js' %}"></script>
    <script src="{% static 'notes/js/forms.js' %}"></script>
    {% block extra_scripts %}{% endblock %}
</body>
</html>
